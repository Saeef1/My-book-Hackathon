# Data Model: Embedding Pipeline

## Document Entity
Represents a page or section of documentation extracted from Docusaurus sites, containing clean text, metadata, and source information.

**Fields:**
- `id` (string): Unique identifier for the document
- `url` (string): Original source URL of the document
- `title` (string): Title of the document/page
- `content` (string): Cleaned text content extracted from the document
- `created_at` (datetime): Timestamp when the document was processed
- `updated_at` (datetime): Timestamp when the document was last updated
- `metadata` (dict): Additional metadata associated with the document

**Validation Rules:**
- URL must be a valid URL format
- Content must not be empty
- Created_at must be a valid timestamp

## Embedding Entity
High-dimensional vector representation of document content generated by Cohere API.

**Fields:**
- `id` (string): Unique identifier for the embedding
- `document_id` (string): Reference to the source document
- `vector` (list[float]): The embedding vector values
- `model` (string): The model used to generate the embedding
- `created_at` (datetime): Timestamp when the embedding was generated

**Validation Rules:**
- Vector must have consistent dimensions based on the model
- Document_id must reference an existing document
- Model must be a valid Cohere model identifier

## Vector Collection Entity
Container in Qdrant database storing embeddings with associated metadata for efficient retrieval.

**Fields:**
- `name` (string): Name of the collection (e.g., "teacher_embedding")
- `size` (int): Dimension of vectors in the collection
- `count` (int): Number of vectors stored in the collection
- `created_at` (datetime): Timestamp when the collection was created

**Validation Rules:**
- Name must follow Qdrant naming conventions
- Size must match the embedding model's output dimensions

## Crawl Job Entity
Configuration and state tracking for the process of crawling and processing a specific Docusaurus site.

**Fields:**
- `id` (string): Unique identifier for the crawl job
- `source_url` (string): Root URL of the Docusaurus site to crawl
- `status` (string): Current status (e.g., "pending", "in_progress", "completed", "failed")
- `start_time` (datetime): When the crawl job started
- `end_time` (datetime): When the crawl job completed
- `processed_count` (int): Number of documents processed
- `error_count` (int): Number of errors encountered
- `config` (dict): Crawl configuration parameters (depth, patterns, etc.)

**Validation Rules:**
- Source_url must be a valid URL
- Status must be one of the defined values
- Start_time must be before end_time (if job is completed)

## Chunk Entity
Represents a segment of text that has been chunked for embedding generation.

**Fields:**
- `id` (string): Unique identifier for the chunk
- `document_id` (string): Reference to the parent document
- `content` (string): The text content of the chunk
- `position` (int): The position of this chunk in the original document
- `metadata` (dict): Additional metadata for the chunk

**Validation Rules:**
- Content must not be empty
- Position must be non-negative
- Document_id must reference an existing document

## RetrievedDocument Entity
Represents a document retrieved from Qdrant with its associated metadata and embedding.

**Fields:**
- `id` (str): Unique identifier for the document in Qdrant
- `content` (str): The text content of the retrieved document
- `embedding` (list[float]): The vector embedding associated with the document
- `metadata` (dict): Additional metadata stored with the document in Qdrant
  - `source_url` (str): URL where the original content was extracted from
  - `title` (str): Title of the document
  - `section` (str): Section or page identifier
  - `created_at` (str): Timestamp when the document was stored
  - `updated_at` (str): Timestamp when the document was last updated
- `score` (float): Similarity score when retrieved via similarity search
- `collection_name` (str): Name of the Qdrant collection where the document is stored

**Validation Rules:**
- `id` must be non-empty string
- `content` must be non-empty string
- `embedding` must be a list of floats with consistent dimensions
- `score` must be between 0 and 1 (for similarity scores)

## QueryRequest Entity
Represents a query request to the retrieval system.

**Fields:**
- `query_text` (str): The text to search for similar documents
- `query_embedding` (list[float]): Pre-computed embedding to search for similar vectors
- `collection_name` (str): Name of the Qdrant collection to search in
- `limit` (int): Maximum number of results to return (default: 10)
- `filters` (dict): Optional filters to apply to the search
  - `source_url` (str): Filter by specific source URL
  - `metadata_filters` (dict): Additional metadata filters
- `search_params` (dict): Additional search parameters
  - `with_payload` (bool): Whether to include payload in results
  - `with_vectors` (bool): Whether to include vectors in results

**Validation Rules:**
- Either `query_text` or `query_embedding` must be provided
- `limit` must be between 1 and 1000
- `collection_name` must be non-empty string

## QueryResponse Entity
Represents the response from a retrieval query.

**Fields:**
- `results` (list[RetrievedDocument]): List of retrieved documents
- `query_id` (str): Unique identifier for the query
- `execution_time` (float): Time taken to execute the query in milliseconds
- `total_count` (int): Total number of matching documents found
- `query_text` (str): The original query text (if provided)
- `status` (str): Status of the query execution ("success", "error", "partial")

**Validation Rules:**
- `results` must be a list of RetrievedDocument objects
- `execution_time` must be non-negative
- `total_count` must be non-negative

## QdrantConnectionConfig Entity
Configuration for connecting to Qdrant.

**Fields:**
- `host` (str): Qdrant host address (default: "localhost")
- `port` (int): Qdrant port (default: 6333)
- `grpc_port` (int): Qdrant gRPC port (default: 6334)
- `https` (bool): Whether to use HTTPS (default: False)
- `api_key` (str): API key for Qdrant Cloud (optional)
- `timeout` (int): Connection timeout in seconds (default: 30)
- `collection_name` (str): Default collection name to use